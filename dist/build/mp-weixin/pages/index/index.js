(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"06bf":function(t,e,n){"use strict";var i=n("3078"),o=n.n(i);o.a},"1b67":function(t,e,n){},3078:function(t,e,n){},8069:function(t,e,n){"use strict";n.r(e);var i=n("da67"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(s);e["default"]=o.a},8194:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n("a34a"));function o(t){return t&&t.__esModule?t:{default:t}}function s(t,e,n,i,o,s,a){try{var u=t[s](a),r=u.value}catch(c){return void n(c)}u.done?e(r):Promise.resolve(r).then(i,o)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function u(t){s(a,i,o,u,r,"next",t)}function r(t){s(a,i,o,u,r,"throw",t)}u(void 0)}))}}function u(t){return d(t)||l(t)||c(t)||r()}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t,e){if(t){if("string"===typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}function l(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function d(t){if(Array.isArray(t))return f(t)}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var h=new Map,p=function(){return Math.max.apply(Math,[200].concat(u(h.values())))+1},g={name:"s-popup",props:{customClass:{type:String,default:""},value:Boolean,position:{type:String,default:"center"},effect:{type:Boolean,default:!0},effectDuration:{type:Number,default:300},mask:{type:Boolean,default:!0},maskOpacity:{type:Number,default:.7},maskClose:{type:Boolean,default:!0},duration:{type:Number,default:0},list:[],beforeShow:Function,beforeHide:Function},data:function(){return Object.assign(this,{popupId:"s-popup-id-"+Math.random().toString(36).substr(2),visibleId:0,visibleStatus:!1,effectTimeoutId:0,autoCloseTimeoutId:0}),{styleZindex:"",visibleClass:"",styleDuration:"",effectClass:""}},computed:{positionClass:function(){return this.position?"s-popup-position-"+this.position:""}},watch:{value:function(){this.updateVisible()}},methods:{show:function(){var t=this;return a(i.default.mark((function e(){var n,o,s;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.visibleStatus){e.next=14;break}if(t.visibleId++,n=!0,o=t.visibleId,!t.beforeShow){e.next=13;break}return e.prev=5,e.next=8,t.beforeShow.call(t.$parent);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](5),n=!1;case 13:o===t.visibleId&&(n?(s=t.effect?t.effectDuration:0,t.visibleStatus=!0,t.$emit("input",!0),h.set(t.popupId,p()),t.styleZindex="z-index:".concat(h.get(t.popupId),";"),t.styleDuration="animation-duration:".concat(s,"ms;"),t.visibleClass="s-popup-visible",t.effectClass="s-popup-effect-enter",clearTimeout(t.effectTimeoutId),t.effectTimeoutId=setTimeout((function(){if(t.styleDuration="",t.effectClass="",t.visibleStatus){t.$emit("show");var e=parseInt(t.duration);e>0&&(clearTimeout(t.autoCloseTimeoutId),t.autoCloseTimeoutId=setTimeout((function(){t.visibleStatus&&t.hide()}),e))}}),s)):t.$emit("input",!1));case 14:case"end":return e.stop()}}),e,null,[[5,10]])})))()},hide:function(){var t=this;return a(i.default.mark((function e(){var n,o,s;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.visibleStatus){e.next=14;break}if(t.visibleId++,n=!0,o=t.visibleId,!t.beforeHide){e.next=13;break}return e.prev=5,e.next=8,t.beforeHide.call(t.$parent);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](5),n=!1;case 13:o===t.visibleId&&(n?(s=t.effect?t.effectDuration:0,t.visibleStatus=!1,t.$emit("input",!1),t.styleDuration="animation-duration:"+s+"ms;",t.effectClass="s-popup-effect-leave",clearTimeout(t.autoCloseTimeoutId),clearTimeout(t.effectTimeoutId),t.effectTimeoutId=setTimeout((function(){t.visibleClass="",t.effectClass="",t.styleZindex="",t.styleDuration="",h.delete(t.popupId),t.visibleStatus||t.$emit("hide")}),s)):t.$emit("input",!0));case 14:case"end":return e.stop()}}),e,null,[[5,10]])})))()},updateVisible:function(){var t=this;this.$nextTick((function(){t.visibleStatus!==t.value&&t[t.value?"show":"hide"]()}))}},mounted:function(){this.updateVisible()},beforeDestroy:function(){h.delete(this.popupId),clearTimeout(this.effectTimeoutId),clearTimeout(this.autoCloseTimeoutId)}};e.default=g},"9b4f":function(t,e,n){"use strict";var i;n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i}));var o=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(t){return t.stopPropagation(),t.preventDefault(),function(t){return t.preventDefault()}(t)},t.e1=function(e){t.maskClose&&t.hide()},t.e2=function(t){return t.stopPropagation(),t.preventDefault(),function(t){return t.preventDefault()}(t)})},s=[]},aa01:function(t,e,n){"use strict";n.r(e);var i=n("8194"),o=n.n(i);for(var s in i)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(s);e["default"]=o.a},b835:function(t,e,n){"use strict";var i;n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return i}));var o=function(){var t=this,e=t.$createElement;t._self._c},s=[]},d537:function(t,e,n){"use strict";(function(t){n("6cdc");i(n("66fd"));var e=i(n("f75a"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},d62a:function(t,e,n){"use strict";n.r(e);var i=n("9b4f"),o=n("aa01");for(var s in o)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(s);n("06bf");var a,u=n("f0c5"),r=Object(u["a"])(o["default"],i["b"],i["c"],!1,null,"6fbed7b0",null,!1,i["a"],a);e["default"]=r.exports},da67:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,o=a(n("0c3f")),s=(a(n("d62a")),a(n("2018")),n("5118"));function a(t){return t&&t.__esModule?t:{default:t}}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var r,c=function(){n.e("components/tabBar").then(function(){return resolve(n("7eac"))}.bind(null,n)).catch(n.oe)},l=function(){Promise.all([n.e("common/vendor"),n.e("pages/components/Index")]).then(function(){return resolve(n("5ac7"))}.bind(null,n)).catch(n.oe)},d=function(){n.e("pages/components/servie").then(function(){return resolve(n("062d"))}.bind(null,n)).catch(n.oe)},f=function(){n.e("pages/components/message").then(function(){return resolve(n("9501"))}.bind(null,n)).catch(n.oe)},h=function(){Promise.all([n.e("common/vendor"),n.e("pages/components/mine")]).then(function(){return resolve(n("afe4"))}.bind(null,n)).catch(n.oe)},p=function(){n.e("pages/components/popup").then(function(){return resolve(n("31ad"))}.bind(null,n)).catch(n.oe)},g=function(){n.e("pages/components/youhuiquan").then(function(){return resolve(n("29be"))}.bind(null,n)).catch(n.oe)},m={components:{TabBar:c,IndexPage:l,Service:d,Message:f,Mine:h,Popup:p,Youhui:g},data:function(){return{isMask:!1,isYouhui:!1,isLing:!1,mask:t.getStorageSync("mask"),index:2,money:0,userInfo:t.getStorageSync("userId"),userCity:null,visible:!0,userId:0,latitude:0,longitude:0,currentTabIndex:null,windows_height:0,recommendArr:[],couponId:null,dataList:{},dataListS:[],msgNum:0,shareUserId:this.$store.state.shareUserId,videoMsg:{},atticMsg:{},scrollTop:0,topsOll:0,opacity:0,flags:!1,flagss:!1,flagsss:!1,foodList:null,playList:[],shopList:[],newList:null,nearList:null}},computed:{isIpx:function(){return this.$isIpx},navHeight:function(){return t.getStorageSync("navHeight")}},onReady:function(){},onLoad:function(e){if(this.getCityHot(),this.getNearLists(),e.shareUserId&&(this.$store.state.shareUserId=e.shareUserId),e.myId&&(this.$store.state.myId=e.myId),e.composId&&(this.$store.state.composId=e.composId),e.ids&&(this.$store.state.ids=e.ids),null!=this.$store.state.composId&&null!=this.$store.state.myId&&null!=this.$store.state.ids&&t.getStorageSync("userId")&&this.isCouponl(),e.scene){var n,i=decodeURIComponent(e.scene),o=i.lastIndexOf("=");n=i.substring(o+1,i.length),this.$store.state.shareUserId=n}if(e.query){var s,a=decodeURIComponent(e.query),u=a.lastIndexOf("=");s=a.substring(u+1,a.length),this.$store.state.couponId=s,this.isGetLing()}this.userCity=t.getStorageSync("location"),this.windows_height=t.getSystemInfoSync().windowHeight,this.isLogin(),this.getList(),e.idx?this.currentTabIndex=Number(e.idx):this.currentTabIndex=0},onShow:function(){this.getCityHot(),this.getNearLists(),null!=this.$store.state.composId&&null!=this.$store.state.myId&&null!=this.$store.state.ids&&t.getStorageSync("userId")&&this.isCouponl(),null!=this.$store.state.couponId&&t.getStorageSync("userId")&&this.isGetLing(),this.isMask=t.getStorageSync("isMask"),this.mask=t.getStorageSync("mask"),this.getList(),this.userCity=t.getStorageSync("location"),2==this.currentTabIndex&&t.getStorageSync("userId"),3==this.currentTabIndex&&this.$refs.minePage.getUser()},onShareAppMessage:function(e){t.getStorageSync("userId");return{title:"购买代金券",imageUrl:"http://www.mingtongxa.com/xcx/shareOmg.png",path:"/pages/index/index?shareUserId=".concat(this.userInfo)}},onShareTimeline:function(){return{title:"购买代金券"}},methods:(i={isLogin:function(){t.getStorageSync("isLogin")||t.getStorageSync("userId")||t.navigateTo({url:"/pages/login/login"})},getNearLists:function(){var e=this,n=t.getStorageSync("quhao"),i={code:n,classId:1,x:t.getStorageSync("longitude"),y:t.getStorageSync("latitude")};n?this.$api.getNearList(i).then((function(t){console.log(t,"555"),200==t.code&&(e.nearList=t.data)})):this.$comfun.Toast("请允许小程序获取您的位置信息","none")},getCityHot:function(){var e=this,n=t.getStorageSync("quhao"),i={code:n};n?this.$api.getLanmuList(i).then((function(t){console.log(t,"555"),200==t.code&&(e.foodList=t.data.food,e.playList=t.data.play,e.shopList=t.data.shop,e.newList=t.data.new)})):this.$comfun.Toast("请允许小程序获取您的位置信息","none")},onPageScroll:function(e){var n=e.scrollTop;n>t.getStorageSync("scroTop")-90?this.flags=!0:this.flags=!1,n>t.getStorageSync("scroTopss")?this.flagsss=!0:this.flagsss=!1,n>400&&(n=400),this.scrollTop=n,this.opacity=n/150},getCouponList:function(){var t=this;this.$api.getQuanList().then((function(e){200==e.code&&(t.money=e.data.discount,t.couponId=e.data.id)}))},closeMask:function(){this.isMask=!1,t.setStorageSync("mask",!1)},closeMasks:function(){this.isYouhui=!1,this.$store.state.composId=null,this.$store.state.myId=null,this.$store.state.ids=null},closeMaskss:function(){this.isLing=!1,this.$store.state.couponId=null},isCouponl:function(){var t=this,e={id:this.$store.state.ids,userId:this.$store.state.myId};this.$api.isGetCouPon(e).then((function(e){0==e.data?t.isYouhui=!0:t.isYouhui=!1}))},isGetLing:function(){var t=this,e={id:this.$store.state.couponId};this.$api.isH5Youhui(e).then((function(e){200==e.code?t.isLing=!0:t.isLing=!1}))},youhuiLingqu:function(){var e=this,n={shareUserId:this.$store.state.myId,receiveUserId:t.getStorageSync("userId"),couponId:this.$store.state.composId,id:this.$store.state.ids,receiveNickName:t.getStorageSync("nickName")};this.$api.shareGetCoupon(n).then((function(n){t.showLoading({title:"领取中"}),200==n.code?(e.$store.state.composId=null,e.$store.state.myId=null,e.$store.state.ids=null,e.isYouhui=!1,t.showToast({title:"领取成功，请至优惠券列表查看~",icon:"none",duration:1500})):(e.$store.state.composId=null,e.$store.state.myId=null,e.$store.state.ids=null,e.isYouhui=!1,t.showToast({title:n.msg,icon:"none",duration:1500}))}))},h5Lingqu:function(){var e=this,n={id:this.$store.state.couponId};this.$api.lingCoupon(n).then((function(n){t.showLoading({title:"领取中"}),200==n.code?(e.$store.state.couponId=null,(0,s.setTimeout)((function(){t.showToast({title:"领取成功-请到个人优惠券列表查看！",icon:"none",duration:1500})}),1e3)):(e.$store.state.couponId=null,t.showToast({title:n.msg,icon:"none",duration:1500}))}))},getListCoupon:function(){var e=this,n={id:this.couponId};t.showLoading({title:"领取中"}),this.$api.getNewList(n).then((function(n){t.hideLoading(),200==n.code&&(e.isMask=!1,t.setStorageSync("isMask",!1),t.showToast({title:"领取成功-请到个人优惠券列表查看！",icon:"none",duration:1500}))}))},getnoList:function(){var e=this;this.$api.userMsgList().then((function(n){if(200==n.code)if(n.data.list.length>0){e.dataList=n.data.list[0],e.dataListS=n.data.list;var i=0;n.data.list.forEach((function(t){0==t.hasRead&&(i+=1)})),e.msgNum=i}else e.dataList={};else t.showToast({title:n.msg,icon:"none",duration:1500})}))},getShengList:function(){var e=this;t.showLoading({mask:!0});var n={pageNum:1,pageSize:10};this.$api.atticList(n).then((function(n){t.hideLoading(),200==n.code?(e.atticMsg=n.data.list[0],t.requestSubscribeMessage({tmplIds:["60aPNS3vXXr7i371iKPpD9VBhmpyqghEx_T9Nw9SSdU"],success:function(t){}})):e.$comfun.Toast(n.msg,"none")}))},getDataList:function(){var e=this;t.showLoading(),this.$api.getProductList().then((function(n){t.hideLoading(),200==n.code?e.videoMsg=n.data.list[0]:e.$comfun.Toast(n.msg,"none")}))},pageTo:function(e){1==e&&t.navigateTo({url:"/subpages/pages/allServeIndex"})},getUserLocation:function(){var e=this;t.getLocation({success:function(t){(t.errMsg="getLocation:ok")&&(r=new o.default.BMapWX({ak:"o9FZ3zhus8bwG08ros15iWXqehXp7zAE"}),r.regeocoding({location:{latitude:t.latitude,longitude:t.longitude},success:function(t){t.result.addressComponent.province;var n=t.result.addressComponent.city;t.result.addressComponent.district;e.userCity=n},fail:function(t){},complete:function(t){}}))}})},gotoMine:function(){t.navigateTo({url:"/pages/index/mine"})},gotoServe:function(){t.navigateTo({url:"/subpages/pages/allServe"})},tabChange:function(t){this.currentTabIndex=t},func:function(t){this.currentTabIndex=t}},u(i,"isLogin",(function(){t.getStorageSync("userId")||t.navigateTo({url:"/pages/login/login"})})),u(i,"getList",(function(){var e=this;this.$api.getServieList().then((function(n){200==n.code&&(e.recommendArr=n.data),401==n.code&&""!=e.userInfo&&t.showModal({title:"提示",content:"您的登录信息已失效，请重新授权登录",showCancel:!0,success:function(e){e.confirm,t.reLaunch({url:"/pages/login/login"})}})}))})),u(i,"sds",(function(){t.requestSubscribeMessage({tmplIds:["60aPNS3vXXr7i371iKPpD9VBhmpyqghEx_T9Nw9SSdU"],success:function(t){console.log(t)},fail:function(t){}})})),i)};e.default=m}).call(this,n("543d")["default"])},dc7c:function(t,e,n){"use strict";var i=n("1b67"),o=n.n(i);o.a},f75a:function(t,e,n){"use strict";n.r(e);var i=n("b835"),o=n("8069");for(var s in o)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(s);n("dc7c");var a,u=n("f0c5"),r=Object(u["a"])(o["default"],i["b"],i["c"],!1,null,"1787be32",null,!1,i["a"],a);e["default"]=r.exports}},[["d537","common/runtime","common/vendor"]]]);